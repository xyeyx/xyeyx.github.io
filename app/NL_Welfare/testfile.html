<!DOCTYPE html>
<html lang="zh_CN">
  <head>
    <meta charset="utf-8">
    <title>测试</title>
  <script src="./solver.js"></script>
<script>
dataurl = 'https://yeconomist.nl/app/NL_Welfare/Resources/data.json';

fetch(dataurl).then(response => {
    return response.json()
}).then(jsonFile => {
    localStorage.setItem('dataraw', JSON.stringify(jsonFile))
})

</script>
  </head>
  <body>
    <header>喵</header>
    <main>
    <div>
    <p>The result is: <span id="doge"></span></p>
    </div>
    </main>
    <footer></footer>
  <script>
  
/*
var 
results,
  model = {
    "optimize": "y",
    "opType": "max",
    "constraints": {
        "1": {"max": 12},
        "2": {"max": 16},
        "v1": {"min": 0},
        "v2": {"min": 0}
    },
    "variables": {
        "x1": {
            "y": 40,
            "1": 1,
            "2": 2,
            "v1": 1,
        },
        "x2": {
            "y": 30,
            "1": 1,
            "2": 1,
            "v2": 1
        }
    },
}
var model1 = model;
results = solver.Solve(model1);



sid = document.getElementById("doge");
sid.textContent = results.result;

*/

// Construct the problem
const dataraw = JSON.parse(localStorage.getItem('dataraw'));


var LPModel = {
    "optimize": "BoD",
    "opType": "max",
    "constraints": {},
    "variables": {},
}

// construct variables 
for (let i = 1; i<5; i++) {LPModel.variables[dataraw.fields[i]] = {}};

// install the BoD term (i.e. itself)

// no negtive value in each of the variable
for (let i = 1; i < 5; i++) {
  LPModel.variables[dataraw.fields[i]]["noNeg_"+dataraw.fields[i]] = 1;
  LPModel.constraints["noNeg_"+dataraw.fields[i]] = {"min": 0};
}; 

// summing up to no more than 100 for any of the individual
for (let j = 0; j<dataraw.count; j++){
    LPModel.constraints["Top100_Nr_"+j.toString()] = {"max":100};
    for (let i= 1; i<5; i++){
        LPModel.variables[dataraw.fields[i]]["Top100_Nr_"+j.toString()] = dataraw.data[j][dataraw.fields[i]];
    }
};


// Location Specific parts in the LP problem

target_id = 2; //Groningen

// Upper and lower bounds
var bounds = {
    lower:[0.1, 0.1, 0.1, 0.1],
    upper:[0.5, 0.5, 0.5, 0.5]
}

// target (BoD)
for (let i = 1; i < 5; i++) {
    LPModel.variables[dataraw.fields[i]]["BoD"] = dataraw.data[target_id][dataraw.fields[i]];
}

// Pie share not larger than upper bound
for  (let i = 1; i < 5; i++) {
 LPModel.constraints["UpPie_"+dataraw.fields[i]] = {"max":0};
 for  (let ii=1; ii< 5;ii++){
   baseval = - bounds.upper[i-1] * dataraw.data[target_id][dataraw.fields[ii]];
   if(i==ii){baseval = baseval + dataraw.data[target_id][dataraw.fields[ii]];};
   LPModel.variables[dataraw.fields[ii]]["UpPie_"+dataraw.fields[i]] = baseval;
 }
}

// Pie share not smaller than lower bound
for  (let i = 1; i < 5; i++) {
 LPModel.constraints["LoPie_"+dataraw.fields[i]] = {"max":0};
 for (let ii= 1; ii< 5;ii++){
   baseval = bounds.lower[i-1] * dataraw.data[target_id][dataraw.fields[ii]];
   if(i==ii){baseval = baseval - dataraw.data[target_id][dataraw.fields[ii]];};
   LPModel.variables[dataraw.fields[ii]]["LoPie_"+dataraw.fields[i]] = baseval;
 }
}


aaa=solver.Solve(LPModel);

sid = document.getElementById("doge");
sid.textContent = aaa.result;

</script>
</body>
</html>

